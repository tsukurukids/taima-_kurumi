<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>集中タイマー</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="icon" type="image/png" href="./icon.png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Chivo Mono', 'monospace'],
                    },
                    colors: {
                        primary: '#6366f1', // Indigo 500
                    }
                }
            }
        }
    </script>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.58/build/Tone.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <style>
        body {
            background-color: #ffffff;
            color: #1e293b;
        }

        .timer-digits {
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        .safe-area-bottom {
            padding-bottom: calc(1.5rem + env(safe-area-inset-bottom, 0px));
        }

        @media (max-width: 640px) {
            .timer-digits {
                font-size: 5rem;
            }
        }

        .btn-hover {
            transition: all 0.2s ease;
        }

        .btn-hover:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-hover:active {
            transform: translateY(0);
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="flex flex-col items-center bg-gray-50 h-[100dvh] w-full overflow-hidden p-0 md:p-4">

    <div id="main-card"
        class="w-full flex-1 md:h-auto md:max-w-md bg-white p-4 md:p-8 md:rounded-2xl shadow-xl border-gray-100 flex flex-col transition-colors duration-500 overflow-hidden relative">

        <!-- View: Timer -->
        <div id="view-timer" class="hidden space-y-4 animate-fade-in flex flex-col items-center justify-center flex-1">

            <div class="text-center space-y-1">
                <h1 id="timer-label-mode" class="text-xl font-bold text-gray-900">モードを選択</h1>
                <p id="timer-label-duration" class="text-indigo-600 font-bold text-base">- 分</p>
                <div id="timer-status" class="text-xs font-medium"></div>
            </div>

            <!-- Timer Display -->
            <div class="text-center py-2 md:py-8">
                <div class="timer-digits font-mono text-7xl md:text-8xl font-bold text-gray-900 tracking-tight"
                    id="timer-display">
                    00:00
                </div>
            </div>

            <!-- Controls -->
            <!-- スタート前: スタートボタン -->
            <div id="controls-idle" class="flex justify-center items-center">
                <button onclick="startTimer()" id="btn-start"
                    class="flex items-center space-x-3 px-10 py-5 rounded-full bg-indigo-600 text-white text-lg font-bold shadow-lg shadow-indigo-600/30 hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <span>スタート</span>
                </button>
            </div>

            <!-- タイマー実行中: 一時停止 + 終了 ボタン -->
            <div id="controls-running" class="hidden flex justify-center items-center space-x-4">
                <!-- 一時停止ボタン -->
                <button onclick="pauseTimer()" id="btn-pause"
                    class="flex items-center space-x-2 px-7 py-4 rounded-full bg-amber-400 text-white text-base font-bold shadow-lg shadow-amber-400/30 hover:bg-amber-500 hover:scale-105 active:scale-95 transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                    </svg>
                    <span>一時停止</span>
                </button>

                <!-- 終了ボタン -->
                <button onclick="stopTimer()" id="btn-stop"
                    class="flex items-center space-x-2 px-7 py-4 rounded-full bg-red-500 text-white text-base font-bold shadow-lg shadow-red-500/30 hover:bg-red-600 hover:scale-105 active:scale-95 transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                        fill="currentColor">
                        <rect x="6" y="6" width="12" height="12" rx="1" />
                    </svg>
                    <span>終了</span>
                </button>
            </div>

            <!-- 一時停止中: 再開 + 終了 ボタン -->
            <div id="controls-paused" class="hidden flex justify-center items-center space-x-4">
                <!-- 再開ボタン -->
                <button onclick="resumeTimer()"
                    class="flex items-center space-x-2 px-7 py-4 rounded-full bg-indigo-600 text-white text-base font-bold shadow-lg shadow-indigo-600/30 hover:bg-indigo-700 hover:scale-105 active:scale-95 transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                        fill="currentColor">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <span>再開</span>
                </button>

                <!-- 終了ボタン -->
                <button onclick="stopTimer()"
                    class="flex items-center space-x-2 px-7 py-4 rounded-full bg-red-500 text-white text-base font-bold shadow-lg shadow-red-500/30 hover:bg-red-600 hover:scale-105 active:scale-95 transition-all duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
                        fill="currentColor">
                        <rect x="6" y="6" width="12" height="12" rx="1" />
                    </svg>
                    <span>終了</span>
                </button>
            </div>
        </div>

        <!-- View: Mode Selection (Hidden) -->
        <div id="view-modes" class="animate-fade-in flex-1 flex flex-col justify-center py-2 overflow-y-auto">

            <div class="flex flex-col space-y-6">
                <!-- Focus Section -->
                <div class="space-y-2">
                    <div class="flex items-center pl-2 pb-1">
                        <div class="p-1.5 bg-indigo-100 text-indigo-500 rounded-full mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </div>
                        <span class="text-base font-bold text-gray-700">集中</span>
                        <button onclick="alert('設定は準備中です')"
                            class="ml-1 p-2 text-gray-400 hover:text-indigo-500 transition-colors flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Duration Presets (Grid) -->
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="selectTime(15)"
                            class="py-3 bg-white border border-gray-200 rounded-xl text-gray-600 font-bold hover:text-indigo-600 hover:border-indigo-200 hover:bg-indigo-50 transition-all shadow-sm text-sm">
                            15分
                        </button>
                        <button onclick="selectTime(30)"
                            class="py-3 bg-white border border-gray-200 rounded-xl text-gray-600 font-bold hover:text-indigo-600 hover:border-indigo-200 hover:bg-indigo-50 transition-all shadow-sm text-sm">
                            30分
                        </button>
                        <button onclick="selectTime(60)"
                            class="py-3 bg-white border border-gray-200 rounded-xl text-gray-600 font-bold hover:text-indigo-600 hover:border-indigo-200 hover:bg-indigo-50 transition-all shadow-sm text-sm">
                            60分
                        </button>
                    </div>
                </div>

                <!-- Break Section -->
                <div class="space-y-2">
                    <div class="flex items-center pl-2 pb-1">
                        <div class="p-1.5 bg-teal-100 text-teal-500 rounded-full mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M5 12h14"></path>
                                <path d="m12 5 7 7-7 7"></path>
                            </svg>
                        </div>
                        <span class="text-base font-bold text-gray-700">休憩</span>
                        <button onclick="alert('設定は準備中です')"
                            class="ml-1 p-2 text-gray-400 hover:text-teal-500 transition-colors flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="selectTime(5, 'shortBreak')"
                            class="py-3 bg-white border border-gray-200 rounded-xl text-gray-600 font-bold hover:text-teal-600 hover:border-teal-200 hover:bg-teal-50 transition-all shadow-sm text-sm">
                            5分
                        </button>
                        <button onclick="selectTime(10, 'shortBreak')"
                            class="py-3 bg-white border border-gray-200 rounded-xl text-gray-600 font-bold hover:text-teal-600 hover:border-teal-200 hover:bg-teal-50 transition-all shadow-sm text-sm">
                            10分
                        </button>
                        <button onclick="selectTime(15, 'shortBreak')"
                            class="py-3 bg-white border border-gray-200 rounded-xl text-gray-600 font-bold hover:text-teal-600 hover:border-teal-200 hover:bg-teal-50 transition-all shadow-sm text-sm">
                            15分
                        </button>
                    </div>
                </div>
            </div>

            <!-- Cancel removed -->
        </div>

        <!-- View: Settings (Hidden) -->
        <div id="view-settings" class="hidden space-y-6 animate-fade-in">
            <h2 class="text-xl font-bold text-gray-900 mb-6">設定</h2>

            <!-- Notification Settings -->
            <div class="space-y-4">
                <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">通知</h3>
                <div class="flex items-center justify-between p-4 rounded-xl bg-gray-50 cursor-pointer"
                    onclick="toggleNotification()">
                    <div class="flex items-center">
                        <div class="p-2 bg-white rounded-full shadow-sm mr-3 text-indigo-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                        </div>
                        <span class="font-bold text-gray-700">通知を許可</span>
                    </div>
                    <div id="notification-toggle"
                        class="w-12 h-7 bg-gray-200 rounded-full relative transition-colors duration-300">
                        <div
                            class="absolute left-1 top-1 w-5 h-5 bg-white rounded-full shadow transition-transform duration-300">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Device Color Settings -->
            <div class="space-y-4">
                <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider">デバイスの色</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="changeTheme('indigo')"
                        class="flex items-center p-3 rounded-xl bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-colors">
                        <div class="w-6 h-6 rounded-full bg-indigo-500 mr-3 shadow-sm"></div>
                        <span class="text-sm font-medium text-gray-700">インディゴ</span>
                    </button>
                    <button onclick="changeTheme('pink')"
                        class="flex items-center p-3 rounded-xl bg-pink-50 border border-pink-100 hover:bg-pink-100 transition-colors">
                        <div class="w-6 h-6 rounded-full bg-pink-500 mr-3 shadow-sm"></div>
                        <span class="text-sm font-medium text-gray-700">ピンク</span>
                    </button>
                    <button onclick="changeTheme('teal')"
                        class="flex items-center p-3 rounded-xl bg-teal-50 border border-teal-100 hover:bg-teal-100 transition-colors">
                        <div class="w-6 h-6 rounded-full bg-teal-500 mr-3 shadow-sm"></div>
                        <span class="text-sm font-medium text-gray-700">ティール</span>
                    </button>
                    <button onclick="changeTheme('dark')"
                        class="flex items-center p-3 rounded-xl bg-gray-100 border border-gray-200 hover:bg-gray-200 transition-colors">
                        <div class="w-6 h-6 rounded-full bg-gray-800 mr-3 shadow-sm"></div>
                        <span class="text-sm font-medium text-gray-700">ダーク</span>
                    </button>
                </div>
            </div>

        </div>
    </div>



    <!-- Bottom Bar Navigation -->
    <div class="w-full max-w-md px-6 pb-6 pt-2 bg-white/80 backdrop-blur-md md:rounded-b-2xl md:mb-4 safe-area-bottom">
        <div class="flex items-center justify-around">
            <!-- Mode (Timer) Trigger -->
            <div onclick="handleClickTimer()"
                class="flex flex-col items-center space-y-1 text-indigo-600 cursor-pointer hover:text-indigo-800 transition-colors group relative">
                <div
                    class="p-3 bg-white rounded-full shadow-sm border border-indigo-100 group-hover:scale-110 transition-transform ring-4 ring-indigo-50/50">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                </div>
                <span class="text-[10px] font-bold tracking-wide text-gray-400 group-hover:text-indigo-600">タイマー</span>
            </div>

            <!-- Record (History) Trigger -->
            <div onclick="alert('記録機能は準備中です')"
                class="flex flex-col items-center space-y-1 text-gray-400 cursor-pointer hover:text-indigo-600 transition-colors group">
                <div
                    class="p-3 bg-white rounded-full shadow-sm border border-gray-100 group-hover:border-indigo-100 group-hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                </div>
                <span class="text-[10px] font-bold tracking-wide text-gray-400 group-hover:text-indigo-600">記録</span>
            </div>

            <!-- Settings Trigger -->
            <div onclick="setView('settings')"
                class="flex flex-col items-center space-y-1 text-gray-400 cursor-pointer hover:text-indigo-600 transition-colors group">
                <div
                    class="p-3 bg-white rounded-full shadow-sm border border-gray-100 group-hover:border-indigo-100 group-hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </div>
                <span class="text-[10px] font-bold tracking-wide text-gray-400 group-hover:text-indigo-600">設定</span>
            </div>
        </div>
    </div>

    <script>
        // --- State ---
        let timerInterval;
        let timeLeft = 0;
        let originalTime = 0;
        let isRunning = false;
        let currentMode = 'none';
        const modes = {
            focus: { time: 25 * 60 },
            shortBreak: { time: 5 * 60 },
            longBreak: { time: 15 * 60 }
        };

        // --- Helper: get DOM elements ---
        function el(id) { return document.getElementById(id); }

        // --- Button State Management ---
        // state: 'idle' | 'running' | 'paused'
        function setControlState(state) {
            ['controls-idle', 'controls-running', 'controls-paused'].forEach(function (id) {
                var d = el(id);
                if (d) d.classList.add('hidden');
            });
            var target = el('controls-' + state);
            if (target) target.classList.remove('hidden');
        }

        // --- Timer Display ---
        function updateDisplay() {
            var display = el('timer-display');
            if (!display) return;
            var absTime = Math.abs(timeLeft);
            var mm = Math.floor(absTime / 60).toString().padStart(2, '0');
            var ss = (absTime % 60).toString().padStart(2, '0');
            display.textContent = mm + ':' + ss;
            document.title = mm + ':' + ss + ' - Timer';
            if (timeLeft < 0) {
                display.classList.remove('text-gray-900', 'text-white');
                display.classList.add('text-red-500');
            } else {
                display.classList.remove('text-red-500');
                display.classList.add('text-gray-900');
            }
        }

        // --- Timer Controls ---
        function startTimer() {
            if (isRunning || timeLeft <= 0) return;
            isRunning = true;
            setControlState('running');
            timerInterval = setInterval(function () {
                timeLeft--;
                updateDisplay();
                if (timeLeft === 0) playSound('complete');
            }, 1000);
            playSound('start');
        }

        function resumeTimer() {
            if (isRunning) return;
            isRunning = true;
            setControlState('running');
            timerInterval = setInterval(function () {
                timeLeft--;
                updateDisplay();
                if (timeLeft === 0) playSound('complete');
            }, 1000);
        }

        function pauseTimer() {
            if (!isRunning) return;
            clearInterval(timerInterval);
            isRunning = false;
            setControlState('paused');
        }

        function stopTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            // 集中モードで少しでも経過していたら記録
            if (currentMode === 'focus' && originalTime - timeLeft > 60) {
                saveSession(originalTime - timeLeft);
            }
            // タイマーをリセット
            timeLeft = originalTime;
            updateDisplay();
            var display = el('timer-display');
            if (display) {
                display.classList.remove('text-red-500');
                display.classList.add('text-gray-900');
            }
            setControlState('idle');
        }

        // --- Session Stats ---
        function saveSession(seconds) {
            const today = new Date().toDateString();
            let stats = JSON.parse(localStorage.getItem('timerStats')) || {};
            if (!stats[today]) stats[today] = { count: 0, minutes: 0 };
            stats[today].count += 1;
            stats[today].minutes += Math.floor(seconds / 60);
            localStorage.setItem('timerStats', JSON.stringify(stats));
        }

        // --- View Navigation ---
        function setView(view) {
            ['view-timer', 'view-settings', 'view-modes'].forEach(id => {
                const v = el(id);
                if (v) v.classList.add('hidden');
            });
            const target = el('view-' + view);
            if (target) target.classList.remove('hidden');
        }

        function handleClickTimer() { setView('modes'); }

        // --- Select Time (called by buttons) ---
        function selectTime(minutes, mode) {
            mode = mode || 'focus';
            // 実行中なら停止
            clearInterval(timerInterval);
            isRunning = false;

            currentMode = mode;
            timeLeft = minutes * 60;
            originalTime = timeLeft;

            var modeLabel = el('timer-label-mode');
            var durationLabel = el('timer-label-duration');
            if (modeLabel) modeLabel.textContent = mode === 'shortBreak' ? '休憩' : '集中';
            if (durationLabel) durationLabel.textContent = minutes + '分';

            updateDisplay();
            setControlState('idle');
            setView('timer');
        }

        // --- Settings ---
        let notificationsEnabled = false;
        function toggleNotification() {
            notificationsEnabled = !notificationsEnabled;
            const toggleBg = el('notification-toggle');
            const toggleDot = toggleBg ? toggleBg.querySelector('div') : null;
            if (notificationsEnabled) {
                if (toggleBg) toggleBg.classList.replace('bg-gray-200', 'bg-indigo-500');
                if (toggleDot) toggleDot.classList.add('translate-x-6');
                if ('Notification' in window) Notification.requestPermission();
            } else {
                if (toggleBg) toggleBg.classList.replace('bg-indigo-500', 'bg-gray-200');
                if (toggleDot) toggleDot.classList.remove('translate-x-6');
            }
        }

        function changeTheme(theme) {
            const mainCard = el('main-card');
            const display = el('timer-display');
            const status = el('timer-status');
            document.body.className = 'flex flex-col items-center bg-gray-50 h-[100dvh] w-full overflow-hidden p-0 md:p-4 transition-colors duration-500';
            if (theme === 'dark') {
                document.body.style.backgroundColor = '#0f172a';
                if (mainCard) mainCard.className = 'w-full flex-1 md:h-auto md:max-w-md bg-slate-900 border border-slate-800 p-4 md:p-8 md:rounded-2xl shadow-xl flex flex-col transition-colors duration-500 overflow-hidden relative';
                if (display) display.className = 'timer-digits font-mono text-7xl md:text-8xl font-bold text-white tracking-tight';
            } else {
                document.body.style.backgroundColor = '#f9fafb';
                if (mainCard) mainCard.className = 'w-full flex-1 md:h-auto md:max-w-md bg-white border border-gray-100 p-4 md:p-8 md:rounded-2xl shadow-xl flex flex-col transition-colors duration-500 overflow-hidden relative';
                if (display) display.className = 'timer-digits font-mono text-7xl md:text-8xl font-bold text-gray-900 tracking-tight';
            }
            if (status) {
                if (theme === 'pink') status.className = 'mt-2 text-pink-500 font-medium';
                else if (theme === 'teal') status.className = 'mt-2 text-teal-500 font-medium';
                else status.className = 'mt-2 text-indigo-500 font-medium';
            }
        }

        // --- Service Worker ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('./sw.js');
            });
        }

        // --- Init ---
        setView('modes');
    </script>
</body>

</html>